<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="yandex-verification" content="3ac9ae36ddebb425">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"liupzmin.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.15.1","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="è®¡ç®—æœºä¹‹æ‰€ä»¥éœ€è¦å¹¶å‘ï¼Œæ˜¯ä¸ºäº†æé«˜ CPU çš„åˆ©ç”¨ç‡ï¼Œå› ä¸ºå¤§å¤šæ•°ä»»åŠ¡åœºæ™¯æ˜¯æ··åˆäº†è®¡ç®—å’Œ I&#x2F;O çš„ï¼Œé‚£ä¹ˆä¸ºäº†å‡å°‘å“åº”æ—¶é—´ï¼Œä½¿ä»»åŠ¡èƒ½å¤Ÿâ€œåŒæ—¶â€è¿›è¡Œï¼Œè®¡ç®—æœºç¨‹åºä¾¿æ¼”åŒ–å‡ºäº†å¹¶å‘çš„æ¦‚å¿µã€‚ æœ¬æ–‡å°±é’ˆå¯¹ CPU-bound å’Œ IO-bound ä¸¤ç§æç«¯åœºæ™¯ï¼Œæ¥èŠä¸€èŠ Go å’Œ Tokio çš„å¹¶å‘æ¨¡å‹åœ¨åº”å¯¹ä¸åŒå¹¶å‘åœºæ™¯ä¸‹çš„å¼‚åŒã€‚ ã€Šå¼‚æ­¥ IO æ¢ç§˜ã€‹ å’Œ ã€Šå¯¹è¯ ChatGPT ç†è§£ Rust å¼‚æ­¥ç½‘">
<meta property="og:type" content="article">
<meta property="og:title" content="å…³äºå¹¶å‘çš„ä¸€ç‚¹æ€è€ƒ">
<meta property="og:url" content="http://liupzmin.com/2023/08/08/golang/a-little-thought-of-concurrency/index.html">
<meta property="og:site_name" content="å…”å­å…ˆç”Ÿ">
<meta property="og:description" content="è®¡ç®—æœºä¹‹æ‰€ä»¥éœ€è¦å¹¶å‘ï¼Œæ˜¯ä¸ºäº†æé«˜ CPU çš„åˆ©ç”¨ç‡ï¼Œå› ä¸ºå¤§å¤šæ•°ä»»åŠ¡åœºæ™¯æ˜¯æ··åˆäº†è®¡ç®—å’Œ I&#x2F;O çš„ï¼Œé‚£ä¹ˆä¸ºäº†å‡å°‘å“åº”æ—¶é—´ï¼Œä½¿ä»»åŠ¡èƒ½å¤Ÿâ€œåŒæ—¶â€è¿›è¡Œï¼Œè®¡ç®—æœºç¨‹åºä¾¿æ¼”åŒ–å‡ºäº†å¹¶å‘çš„æ¦‚å¿µã€‚ æœ¬æ–‡å°±é’ˆå¯¹ CPU-bound å’Œ IO-bound ä¸¤ç§æç«¯åœºæ™¯ï¼Œæ¥èŠä¸€èŠ Go å’Œ Tokio çš„å¹¶å‘æ¨¡å‹åœ¨åº”å¯¹ä¸åŒå¹¶å‘åœºæ™¯ä¸‹çš„å¼‚åŒã€‚ ã€Šå¼‚æ­¥ IO æ¢ç§˜ã€‹ å’Œ ã€Šå¯¹è¯ ChatGPT ç†è§£ Rust å¼‚æ­¥ç½‘">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-08-08T10:08:30.000Z">
<meta property="article:modified_time" content="2025-02-07T01:32:12.639Z">
<meta property="article:author" content="å·´æµ">
<meta property="article:tag" content="golang - network - tokio - asynchronous">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://liupzmin.com/2023/08/08/golang/a-little-thought-of-concurrency/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://liupzmin.com/2023/08/08/golang/a-little-thought-of-concurrency/","path":"2023/08/08/golang/a-little-thought-of-concurrency/","title":"å…³äºå¹¶å‘çš„ä¸€ç‚¹æ€è€ƒ"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>å…³äºå¹¶å‘çš„ä¸€ç‚¹æ€è€ƒ | å…”å­å…ˆç”Ÿ</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="å…”å­å…ˆç”Ÿ" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">å…”å­å…ˆç”Ÿ</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">æ¢å¯»è®¡ç®—æœºçš„å†å²ä¸å“²å­¦å¯†ç </p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>å½’æ¡£<span class="badge">60</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>æ ‡ç­¾<span class="badge">63</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>åˆ†ç±»<span class="badge">32</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>å…³äº</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="å·´æµ"
      src="/images/gzh.jpg">
  <p class="site-author-name" itemprop="name">å·´æµ</p>
  <div class="site-description" itemprop="description">å·¦æ‰‹äººæ–‡ | å³æ‰‹ç§‘æŠ€</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">60</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">63</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xpdXB6bWlu" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;liupzmin"><i class="github fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOmxpdXB6bWluQGdtYWlsLmNvbQ==" title="E-Mail â†’ mailto:liupzmin@gmail.com"><i class="envelope fa-fw"></i></span>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS â†’ &#x2F;atom.xml" rel="noopener me"><i class="fa fa-rss fa-fw"></i></a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://liupzmin.com/2023/08/08/golang/a-little-thought-of-concurrency/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/gzh.jpg">
      <meta itemprop="name" content="å·´æµ">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="å…”å­å…ˆç”Ÿ">
      <meta itemprop="description" content="å·¦æ‰‹äººæ–‡ | å³æ‰‹ç§‘æŠ€">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="å…³äºå¹¶å‘çš„ä¸€ç‚¹æ€è€ƒ | å…”å­å…ˆç”Ÿ">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          å…³äºå¹¶å‘çš„ä¸€ç‚¹æ€è€ƒ<span class="exturl post-edit-link" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xpdXB6bWluL2xpdXB6bWluLmdpdGh1Yi5pby9lZGl0L2hleG9fcmVzb3VyY2Uvc291cmNlL19wb3N0cy9nb2xhbmcvYS1saXR0bGUtdGhvdWdodC1vZi1jb25jdXJyZW5jeS5tZA==" title="ç¼–è¾‘"><i class="fa fa-pen-nib"></i></span>
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-08-08 18:08:30" itemprop="dateCreated datePublished" datetime="2023-08-08T18:08:30+08:00">2023-08-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-02-07 09:32:12" itemprop="dateModified" datetime="2025-02-07T09:32:12+08:00">2025-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/golang/" itemprop="url" rel="index"><span itemprop="name">golang</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>è®¡ç®—æœºä¹‹æ‰€ä»¥éœ€è¦å¹¶å‘ï¼Œæ˜¯ä¸ºäº†æé«˜ CPU çš„åˆ©ç”¨ç‡ï¼Œå› ä¸ºå¤§å¤šæ•°ä»»åŠ¡åœºæ™¯æ˜¯æ··åˆäº†è®¡ç®—å’Œ I&#x2F;O çš„ï¼Œé‚£ä¹ˆä¸ºäº†å‡å°‘å“åº”æ—¶é—´ï¼Œä½¿ä»»åŠ¡èƒ½å¤Ÿâ€œåŒæ—¶â€è¿›è¡Œï¼Œè®¡ç®—æœºç¨‹åºä¾¿æ¼”åŒ–å‡ºäº†å¹¶å‘çš„æ¦‚å¿µã€‚</p>
<p>æœ¬æ–‡å°±é’ˆå¯¹ CPU-bound å’Œ IO-bound ä¸¤ç§æç«¯åœºæ™¯ï¼Œæ¥èŠä¸€èŠ Go å’Œ Tokio çš„å¹¶å‘æ¨¡å‹åœ¨åº”å¯¹ä¸åŒå¹¶å‘åœºæ™¯ä¸‹çš„å¼‚åŒã€‚</p>
<p><a href="https://liupzmin.com/2023/06/28/golang/netpoller/">ã€Šå¼‚æ­¥ IO æ¢ç§˜ã€‹</a> å’Œ <a href="https://liupzmin.com/2023/06/08/network/talk-rust-async-netio-with-chatgpt/">ã€Šå¯¹è¯ ChatGPT ç†è§£ Rust å¼‚æ­¥ç½‘ç»œ ioã€‹</a> å·²åŸºäº Linux å¹³å°å°± Go å’Œ Tokio çš„ç½‘ç»œæ¨¡å‹åšäº†ç®€è¦å‰–æï¼Œå¤§è‡´æœ‰å¦‚ä¸‹å‡ ä¸ªè¦ç‚¹ï¼š</p>
<ol>
<li>åº•å±‚ Reactor éƒ½æ˜¯ éé˜»å¡ I&#x2F;O + epoll æ¨¡å‹ã€‚</li>
<li>äº‹ä»¶å¤„ç†æ–¹å¼ä¸åŒã€‚Go ç´§å¯†ç»“åˆ goroutineï¼Œè®©ç½‘ç»œäº‹ä»¶è½¬åŒ–ä¸ºå¯¹ç½‘ç»œæ–‡ä»¶æè¿°ç¬¦æ„Ÿå…´è¶£çš„ goroutineï¼Œå¹¶å°†å…¶æ³¨å…¥è¿è¡Œé˜Ÿåˆ—ï¼Œä¼ºæœºè°ƒåº¦ï¼›Tokio åŸºäºå”¤é†’æœºåˆ¶å‚¬åŠ¨ Executor å»è½®è¯¢æ¯ä¸ª Futureï¼Œæ¯ä¸ª Future éƒ½è¢«ç¼–è¯‘ä¸ºä¸€ä¸ªçŠ¶æ€æœºã€‚</li>
<li>å¼‚æ­¥ç¼–ç¨‹æ˜¯å¯¹å¹¶å‘æ¨¡å‹çš„è€ƒéªŒã€‚ç¨‹åºå¿…é¡»æœ‰èƒ½åŠ›æŒ‚èµ·ä¸èƒ½ç»§ç»­çš„ä»»åŠ¡ï¼Œè½¬è€Œæ‰§è¡Œå…¶å®ƒçš„ä»»åŠ¡ï¼Œå› ä¸ºç½‘ç»œæ–‡ä»¶æè¿°ç¬¦éé˜»å¡çš„ç‰¹æ€§ï¼Œå¼‚æ­¥ç½‘ç»œ I&#x2F;O æ‰ä¼šæˆä¸ºå¯èƒ½ã€‚</li>
<li>æ™®é€šæ–‡ä»¶ I&#x2F;O çš„å¼‚æ­¥è§£å†³æ–¹æ¡ˆéœ€è¦ç­‰å¾… io_uring çš„æ™®åŠã€‚</li>
</ol>
<p>å…³äºâ€œ<strong>å¼‚æ­¥ç¼–ç¨‹æ˜¯å¯¹å¹¶å‘æ¨¡å‹çš„è€ƒéªŒ</strong>&quot;è¿™ä¸€ç‚¹ï¼Œå¯ä»¥ä» Tokio å®˜æ–¹å¯¹äºå¼‚æ­¥ç¼–ç¨‹çš„è®ºè¿°ä¸­å¾—åˆ°å°è¯ï¼š</p>
<blockquote>
<p>What is asynchronous programming?</p>
<p>Most computer programs are executed in the same order in which they are written. The first line executes, then the next, and so on. With synchronous programming, when a program encounters an operation that cannot be completed immediately, it will block until the operation completes. For example, establishing a TCP connection requires an exchange with a peer over the network, which can take a sizeable amount of time. During this time, the thread is blocked.</p>
<p>With asynchronous programming, operations that cannot complete immediately are suspended to the background. The thread is not blocked, and can continue running other things. Once the operation completes, the task is unsuspended and continues processing from where it left off. Our example from before only has one task, so nothing happens while it is suspended, but asynchronous programs typically have many such tasks.</p>
<p>Although asynchronous programming can result in faster applications, it often results in much more complicated programs. The programmer is required to track all the state necessary to resume work once the asynchronous operation completes. Historically, this is a tedious and error-prone task.</p>
</blockquote>
<p><strong>With asynchronous programming, operations that cannot complete immediately are suspended to the background</strong>ï¼Œä¸èƒ½ç»§ç»­çš„ä»»åŠ¡ï¼Œè¦è¢«æ‰”åˆ°åå°ã€‚</p>
<p><strong>The thread is not blocked, and can continue running other things</strong>ï¼Œåº•å±‚çº¿ç¨‹ä¸å› æ­¤è€Œé˜»å¡ï¼Œç»§ç»­è¿è¡Œå…¶å®ƒä»»åŠ¡ã€‚</p>
<p><strong>Once the operation completes, the task is unsuspended and continues processing from where it left off</strong>ï¼Œå½“è¢«å¼‚æ­¥çš„æ“ä½œå®Œæˆåï¼Œè¢«ç»ˆæ­¢çš„ä»»åŠ¡æ¢å¤æ‰§è¡Œã€‚</p>
<p>æ‰€ä»¥ï¼Œâ€œ<strong>å¼‚æ­¥ç¼–ç¨‹</strong>â€å’Œâ€œ<strong>å¼‚æ­¥</strong>â€è¿™ä¸¤ä¸ªæ¦‚å¿µæ˜¯æœ‰æ‰€åŒºåˆ«çš„ï¼Œâ€œ<strong>å¼‚æ­¥</strong>â€æ˜¯ä¸€ç§ç‰¹æ€§ï¼Œâ€œ<strong>å¼‚æ­¥ç¼–ç¨‹</strong>â€æ˜¯åŸºäºæ­¤ç‰¹æ€§æ¼”åŒ–å‡ºçš„ç¼–ç¨‹èŒƒå¼ã€‚</p>
<p>â€œå¼‚æ­¥â€å¹¶ä¸ä¼šä½¿å•ä¸ªä»»åŠ¡åŠ é€Ÿï¼ŒNetpoller å’Œ Tokio éƒ½æ˜¯ä¸ºäº†è§£å†³é«˜å¹¶å‘ç½‘ç»œ I&#x2F;O è€Œç”Ÿçš„ï¼Œå¹¶ä¸ä¼šåŠ é€ŸæŸä¸ªå•ä¸€çš„ä»»åŠ¡ï¼Œè€Œæ˜¯è®©å¤šä¸ªä»»åŠ¡åœ¨æœ‰é™çš„ CPUèµ„æºä¸‹ï¼Œè·‘å‡ºæ¥è¿‘å•ä¸ªä»»åŠ¡çš„å“åº”æ—¶é—´ï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹ CPU çš„å……åˆ†åˆ©ç”¨ã€‚</p>
<p>åœ¨æˆ‘çœ‹æ¥ï¼ŒTokio å£ä¸­å¼‚æ­¥ç¼–ç¨‹çš„å¤æ‚æ€§ï¼Œå®Œå…¨æ¥è‡ªäºæ€§èƒ½è€ƒé‡ä¸‹çš„æƒè¡¡ï¼Œå®ƒè§£å†³çš„æ˜¯é«˜å¹¶å‘ç½‘ç»œ I&#x2F;O çš„é—®é¢˜ï¼Œè€Œä¸æ˜¯å¹¶å‘çš„é—®é¢˜ã€‚ä¸åŒçš„è®¾è®¡å“²å­¦ï¼Œè®©å®ƒä»¬åœ¨å¹¶å‘ CPU-bound ä»»åŠ¡ä¸Šèµ°å‘äº†ä¸åŒçš„ç›®æ ‡ã€‚</p>
<p>æˆ‘ä»¬çœ‹ä¸€ä¸ªå¹¶å‘ CPU çš„ä¾‹å­ï¼Œæ­¤ä¾‹ä¸­æœ‰ 1 ä¸‡ä¸ªå¹¶å‘ä»»åŠ¡é€’å½’è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚è¿è¡Œç¯å¢ƒä¸º 8 æ ¸ï¼Œ16G å†…å­˜ï¼ŒManjaro Linuxï¼š</p>
<p><strong>Go</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;sync&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fib</span><span class="params">(n <span class="type">int</span>)</span></span> <span class="type">int</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> n == <span class="number">0</span> || n == <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> n</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> fib(n<span class="number">-1</span>) + fib(n<span class="number">-2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//runtime.GOMAXPROCS(24)</span></span><br><span class="line">	ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="type">float64</span>, <span class="number">8</span>)</span><br><span class="line">	done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">	before := time.Now()</span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++ &#123;</span><br><span class="line">		wg.Add(<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> wg.Done()</span><br><span class="line">			_ = fib(<span class="number">40</span>)</span><br><span class="line">			el := time.Since(before).Seconds()</span><br><span class="line">			ch &lt;- el</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			<span class="keyword">select</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> v := &lt;-ch:</span><br><span class="line">				fmt.Printf(<span class="string">&quot;è€—æ—¶ï¼š%fs&quot;</span>, v)</span><br><span class="line">			<span class="keyword">case</span> &lt;-done:</span><br><span class="line">				<span class="keyword">return</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	wg.Wait()</span><br><span class="line">	elapsed := time.Since(before)</span><br><span class="line">	<span class="built_in">close</span>(done)</span><br><span class="line">	fmt.Println(elapsed, <span class="string">&quot;total,&quot;</span>, elapsed/<span class="number">10000</span>, <span class="string">&quot;avg per iteration&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<blockquote>
<p>è€—æ—¶åŒºé—´ï¼š676 s ~ 814 s    æ€»è€—æ—¶ï¼š814s   å¹³å‡è€—æ—¶ï¼š81.4 ms </p>
</blockquote>
<p>å†æ¥çœ‹çœ‹ Tokioï¼Œä¾æ® Tokio å®˜ç½‘å»ºè®®ï¼Œè®¡ç®—å‹ä»»åŠ¡ä½¿ç”¨<a target="_blank" rel="noopener" href="https://docs.rs/tokio/1.29.1/tokio/task/fn.spawn_blocking.html"><code>spawn_blocking</code></a> ï¼Œå®ƒä¼šå°†ä»»åŠ¡æ´¾å‘åˆ°ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹æ± ï¼Œæ ¹æ®å¹¶å‘ä»»åŠ¡çš„æ•°é‡ï¼Œè¿™ä¸ªçº¿ç¨‹æ± ä¼šå¢é•¿åˆ°æœ€å¤š 500 ä¸ªçº¿ç¨‹ï¼š</p>
<p><strong>Tokio</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> std::time::Instant;</span><br><span class="line"><span class="keyword">use</span> tokio::task;</span><br><span class="line"><span class="keyword">use</span> futures::future::&#123;<span class="keyword">self</span>, join_all&#125;;</span><br><span class="line"><span class="keyword">use</span> std::sync::mpsc;</span><br><span class="line"><span class="keyword">use</span> std::fs::File;</span><br><span class="line"><span class="keyword">use</span> std::io::&#123;Read, Write&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#[tokio::main]</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (tx, rx) = mpsc::<span class="title function_ invoke__">channel</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">start</span> = Instant::<span class="title function_ invoke__">now</span>();</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">i</span> <span class="keyword">in</span> <span class="number">1</span>..=<span class="number">10000</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">tt</span> = tx.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">        task::<span class="title function_ invoke__">spawn_blocking</span>(<span class="keyword">move</span>|| &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">r</span> = <span class="title function_ invoke__">fib</span>(<span class="number">40</span>);</span><br><span class="line">            <span class="keyword">let</span> <span class="variable">duration</span> = start.<span class="title function_ invoke__">elapsed</span>();</span><br><span class="line">            <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">dev_null</span> = File::<span class="title function_ invoke__">create</span>(<span class="string">&quot;/dev/null&quot;</span>).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            dev_null.<span class="title function_ invoke__">write</span>(&amp;r.<span class="title function_ invoke__">to_le_bytes</span>()).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            tt.<span class="title function_ invoke__">send</span>(duration.<span class="title function_ invoke__">as_secs_f64</span>() ).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">            <span class="title function_ invoke__">drop</span>(tt);</span><br><span class="line">            <span class="number">0</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">drop</span>(tx);</span><br><span class="line">    <span class="keyword">for</span> <span class="variable">received</span> <span class="keyword">in</span> rx &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot;è€—æ—¶: &#123;:?&#125;&quot;</span>, received);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">duration</span> = start.<span class="title function_ invoke__">elapsed</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;æ€»è€—æ—¶: &#123;:?&#125;&quot;</span>, duration);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;å¹³å‡è€—æ—¶: &#123;:?&#125;&quot;</span>, duration / <span class="number">10000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">fib</span>(n: <span class="type">u64</span>) <span class="punctuation">-&gt;</span> <span class="type">u64</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span> || n == <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">fib</span>(n - <span class="number">1</span>) + <span class="title function_ invoke__">fib</span>(n - <span class="number">2</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<blockquote>
<p>è€—æ—¶åŒºé—´ï¼š0.6 s ~ 564 s    æ€»è€—æ—¶ï¼š564s   å¹³å‡è€—æ—¶ï¼š56.4 ms </p>
</blockquote>
<p>Tokio å»ºè®®ä½¿ç”¨ Rayon æ¥è¿è¡Œ CPU-bound ä»»åŠ¡ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ï¼ŒRayon çš„ç‰ˆæœ¬ï¼š</p>
<p><strong>Rayon</strong></p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> rayon::prelude::*;</span><br><span class="line"><span class="keyword">use</span> std::time::Instant;</span><br><span class="line"><span class="keyword">use</span> std::sync::mpsc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">fib</span>(n: <span class="type">u32</span>) <span class="punctuation">-&gt;</span> <span class="type">u32</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_ invoke__">fib</span>(n - <span class="number">2</span>) + <span class="title function_ invoke__">fib</span>(n - <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨rayonçš„å¹¶è¡Œè¿­ä»£å™¨æ¥é‡å¤è®¡ç®—ä¸€ä¸‡æ¬¡</span></span><br><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> (tx, rx) = mpsc::<span class="title function_ invoke__">channel</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="variable">start</span> = Instant::<span class="title function_ invoke__">now</span>();</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">results</span> = <span class="built_in">vec!</span>[<span class="number">0</span>; <span class="number">10000</span>];</span><br><span class="line">    results.<span class="title function_ invoke__">par_iter_mut</span>().for_each_with(tx,|tx,r| &#123;</span><br><span class="line">        *r = <span class="title function_ invoke__">fib</span>(<span class="number">40</span>);</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">duration</span> = start.<span class="title function_ invoke__">elapsed</span>();</span><br><span class="line">        <span class="keyword">let</span> <span class="variable">tt</span> = tx.<span class="title function_ invoke__">clone</span>();</span><br><span class="line">        tt.<span class="title function_ invoke__">send</span>(duration.<span class="title function_ invoke__">as_secs_f64</span>() ).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">        <span class="title function_ invoke__">drop</span>(tt);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> <span class="variable">received</span> <span class="keyword">in</span> rx &#123;</span><br><span class="line">        <span class="built_in">print!</span>(<span class="string">&quot;è€—æ—¶: &#123;:?&#125;&quot;</span>, received);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="variable">duration</span> = start.<span class="title function_ invoke__">elapsed</span>();</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;æ€»è€—æ—¶: &#123;:?&#125;&quot;</span>, duration);</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;å¹³å‡è€—æ—¶: &#123;:?&#125;&quot;</span>, duration / <span class="number">10000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œç»“æœï¼š</p>
<blockquote>
<p>è€—æ—¶åŒºé—´ï¼š0.00420079 s ~ 503 s    æ€»è€—æ—¶ï¼š507s   å¹³å‡è€—æ—¶ï¼š50 ms </p>
</blockquote>
<p>Rayon é»˜è®¤åªä½¿ç”¨ä¸ CPU æ•°é‡ç›¸åŒçš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼Œæ‰§è¡Œæ•ˆç‡åè€Œæ¯” Tokio ç•¥å¥½ï¼ŒTokio å› ä¸ºå¯åŠ¨äº†å¤§é‡çš„çº¿ç¨‹ï¼Œå¯¼è‡´æˆ‘çš„ç”µè„‘å·²æ— æ³•æ­£å¸¸å“åº”é”®é¼ äº†ã€‚</p>
<table>
<thead>
<tr>
<th>Object</th>
<th>åŒºé—´</th>
<th>æ€»è€—æ—¶</th>
<th>å¹³å‡</th>
</tr>
</thead>
<tbody><tr>
<td>Go</td>
<td>676 s ~ 814 s</td>
<td>814 s</td>
<td>81.4 ms</td>
</tr>
<tr>
<td>Tokio</td>
<td>0.6 s ~ 564 s</td>
<td>564 s</td>
<td>56.4 ms</td>
</tr>
<tr>
<td>Rayon</td>
<td>0.00420079 s ~ 503 s</td>
<td>507 s</td>
<td>50 ms</td>
</tr>
</tbody></table>
<p>ç”±äºä¾‹å­çš„ç‰¹æ®Šæ€§ï¼Œåœ¨æ€»çš„æ‰§è¡Œæ—¶é—´ä¸Šï¼ŒGo æ²¡æœ‰ä»»ä½•ä¼˜åŠ¿å¯è¨€ï¼Œå› ä¸º Go å’Œ Rust çš„å®šä½ä¸åŒï¼Œæ€§èƒ½ä¹Ÿæœ‰å·®è·ï¼Œæ‰€ä»¥æ¯”è¾ƒæ€»è€—æ—¶å¹¶æ²¡æœ‰æ„ä¹‰ã€‚æˆ‘ä»¬è¿™é‡Œä¸»è¦è§‚å¯Ÿæ¯ä¸ªä»»åŠ¡çš„è€—æ—¶åŒºé—´ã€‚</p>
<p>è¿™é‡Œæœ‰æ„æ€çš„æ˜¯ Go çš„æ‰€æœ‰ä»»åŠ¡è€—æ—¶è¶‹å‘äºâ€œå¹³å‡â€ï¼Œè€Œ Rust çš„ä¸¤ä¸ªæ¡†æ¶æ˜¯åœ¨æ¯ä¸ªçº¿ç¨‹ä¸Šä¸²è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œä»»åŠ¡è€—æ—¶å¦‚åŒä¿¡å·å›¾æ ‡ğŸ“¶ï¼Œç”±ä½åˆ°é«˜æ¸è¿›å¼å¢é•¿ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœè®¡ç®—ä»»åŠ¡ä¹‹é—´æ²¡æœ‰ä¾èµ–ï¼Œæ›´çœ‹é‡æ€»çš„å“åº”æ—¶é—´çš„è¯ï¼Œä½¿ç”¨ä¸ CPU æ ¸æ•°ç›¸å½“çš„çº¿ç¨‹æ± è¿›è¡Œå¹¶è¡Œè®¡ç®—èƒ½å¾—åˆ°æœ€ä½³æ•ˆæœï¼›å¦‚æœä»»åŠ¡æ˜¯å¹¶å‘çš„ï¼Œæ›´åŠ æ³¨é‡å•ä¸ªä»»åŠ¡çš„å“åº”æ—¶é—´ï¼Œç±»ä¼¼äº Go çš„å¹¶å‘æ¨¡å‹å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚æœ¬æ–‡æ‰€ä¸¾çš„ç¤ºä¾‹ï¼Œæ¯ä¸ªä»»åŠ¡çš„è®¡ç®—é‡ç›¸å½“ï¼Œå¹¶ä¸èƒ½ä½“ç° Go çš„è¿™ä¸€ä¼˜åŠ¿ï¼Œä¸è¿‡å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼šå¹¶å‘é€”ä¸­ï¼Œä¸€ä¸ªè®¡ç®—é‡å¾ˆå°çš„ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ï¼Œä¸Šè¿°ä¸¤ç§ä»»åŠ¡å¤„ç†æ–¹å¼ä¼šç»™å‡ºä¸åŒçš„ç»“æœã€‚</p>
<p>Go æ˜¯ä¸ºå¹¶å‘è€Œç”Ÿçš„è¯­è¨€ï¼Œæ‰€ä»¥ä½ ä¼šå‘ç°ï¼Œåœ¨ç¼–å†™ Go ä»£ç çš„æ—¶å€™ï¼Œä½ æ ¹æœ¬ä¸ç”¨å»è€ƒè™‘å¹¶å‘ä»»åŠ¡æ˜¯è®¡ç®—å‹è¿˜æ˜¯ I&#x2F;O å‹çš„ï¼Œåœ¨å…¶å¹¶å‘æ¨¡å‹ä¸‹æ‰€æœ‰çš„ä»»åŠ¡éƒ½ä¼šå°½å¯èƒ½å¾—åˆ°åŠæ—¶çš„å¤„ç†ï¼›è€Œå¯¹äºç¼ºä¹å®Œå–„è°ƒåº¦è¿è¡Œæ—¶çš„çº¿ç¨‹æ± æ¥è¯´ï¼Œå…¶æ³¨æ„äº‹é¡¹å°±å¾ˆå¤šäº†ï¼Œä½ è¦å°å¿ƒç¿¼ç¿¼ï¼Œä¸èƒ½åœ¨å¼‚æ­¥ä»»åŠ¡ä¸­å†™å¤ªå¤šè®¡ç®—çš„ä»£ç ã€‚å¯¹æ­¤ï¼Œç”šè‡³æœ‰åšä¸»æŒ‡å‡ºï¼š<a target="_blank" rel="noopener" href="https://ryhl.io/blog/async-what-is-blocking/">åœ¨è¿›å…¥<code>.await</code>ä¹‹å‰ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡10 ~ 100 å¾®ç§’</a>ã€‚</p>
<p>é“ç†ä¸éš¾ç†è§£ï¼Œä»¥ Tokio ä¸ºä¾‹ï¼Œè™½ç„¶å¯ä»¥è¿è¡Œ CPU å¯†é›†å‹ä»»åŠ¡ï¼Œä½†æ˜¯å®˜æ–¹å¾ˆæ˜ç¡®çš„è¯´ä½ è¦æ–°å¼€å®ä¾‹å»è¿è¡Œï¼Œä¸è¦é¥¿æ­» I&#x2F;O ä»»åŠ¡ï¼Œæ˜¾ç„¶è¿™æ˜¯å› ä¸ºè¿è¡Œæ—¶ç¼ºä¹è°ƒåº¦èƒ½åŠ›çš„æŠ˜ä¸­æ–¹æ¡ˆã€‚CPU å¯†é›†å‹ä»»åŠ¡å±äºä¼šé˜»å¡ executor çº¿ç¨‹çš„ä»»åŠ¡ï¼Œå®¹æ˜“éœ¸å  CPU è€Œé¥¿åæˆ–è€…é¥¿æ­»å…¶å®ƒä»»åŠ¡ï¼Œæ­¤æ—¶åªèƒ½é æ‰‹åŠ¨ yield æ¥è®©å‡º CPUï¼Œç»™å…¶å®ƒä»»åŠ¡ä»¥è¿è¡Œçš„æœºä¼šï¼›è€Œç½‘ç»œ I&#x2F;O ä¹‹æ‰€ä»¥é€‚åˆï¼Œå®Œå…¨æ˜¯å› ä¸ºæœ‰éé˜»å¡ç‰¹æ€§å’Œ Reactor çš„å­˜åœ¨ï¼Œæ¯ä¸ª I&#x2F;O è¯»å†™ç‚¹éƒ½æ˜¯ä¸€æ¬¡ yield çš„æœºä¼šï¼</p>
<p>ä¸éš¾æƒ³è§çš„æ˜¯ï¼ŒTokio è™½ç„¶é€‚åˆç½‘ç»œ I&#x2F;O å‹å¹¶å‘ï¼Œä½†æ˜¯ä¹Ÿè¦åœ¨ I&#x2F;O ä»»åŠ¡é‡Œå°å¿ƒåœ°æ§åˆ¶è®¡ç®—å‹ä»£ç çš„æ—¶é—´ï¼Œå¦åˆ™ä¼šå¯¼è‡´è¿è¡Œæ—¶ä»»åŠ¡è°ƒåº¦ä¸å‡ï¼Œä»è€Œé•¿æ—¶é—´é˜»å¡å…¶å®ƒä»»åŠ¡çš„è¿è¡Œã€‚</p>
<p>æ˜¯æ€»çš„å“åº”æ—¶é—´ä¼˜å…ˆï¼Ÿè¿˜æ˜¯æ¯ä¸ªä»»åŠ¡çš„åŠæ—¶å“åº”ä¼˜å…ˆï¼Ÿè¿™æ˜¯ä¸€ç§é€‰æ‹©å’Œæƒè¡¡ï¼</p>
<p><strong>PS: ä½œä¸ºé™æ€è¯­è¨€ï¼ŒGo çš„æ€§èƒ½çœŸæ˜¯å·®äº† Rust ä¸€å¤§æˆªï¼Œå¸Œæœ›æ€§èƒ½èƒ½å†ä¸Šä¸€ä¸ªå°é˜¶ï¼</strong></p>
<p><em><strong>å‚è€ƒæ–‡çŒ®</strong></em></p>
<ol>
<li><span class="exturl" data-url="aHR0cHM6Ly90b2tpby5ycy90b2tpby90dXRvcmlhbC9oZWxsby10b2tpbw==">Hello Tokio<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnJzL3Rva2lvL2xhdGVzdC90b2tpby9pbmRleC5odG1sI2NwdS1ib3VuZC10YXNrcy1hbmQtYmxvY2tpbmctY29kZQ==">CPU-bound tasks and blocking code<i class="fa fa-external-link-alt"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9yeWhsLmlvL2Jsb2cvYXN5bmMtd2hhdC1pcy1ibG9ja2luZy8=">Async: What is blocking?<i class="fa fa-external-link-alt"></i></span></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="followme">
  <span>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¶å®ƒå‘å¸ƒæ¸ é“</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/golang-network-tokio-asynchronous/" rel="tag"># golang - network - tokio - asynchronous</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/06/28/golang/netpoller/" rel="prev" title="å¼‚æ­¥ I/O æ¢ç§˜ â€”â€” ä¸ºä»€ä¹ˆè¯´ Go ä¸ºæˆ‘ä»¬æä¾›äº†åŒæ­¥çš„ç½‘ç»œç¼–ç¨‹æ¥å£ ï¼Ÿ">
                  <i class="fa fa-chevron-left"></i> å¼‚æ­¥ I/O æ¢ç§˜ â€”â€” ä¸ºä»€ä¹ˆè¯´ Go ä¸ºæˆ‘ä»¬æä¾›äº†åŒæ­¥çš„ç½‘ç»œç¼–ç¨‹æ¥å£ ï¼Ÿ
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/10/05/theory/lua/" rel="next" title="ç¥å¥‡çš„ lua">
                  ç¥å¥‡çš„ lua <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2014 â€“ 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">NexT</span>
</div>
  <div class="powered-by">ç”± <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl" data-url="aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZw==">NexT.Gemini</span> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xpdXB6bWlu" title="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" aria-label="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  


  <script src="/js/third-party/fancybox.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"liupzmin","repo":"liupzmin.github.io","client_id":"77654195445087c01c56","client_secret":"eda09eecd05b86f0ef995d8067ec751abeb753d9","admin_user":"liupzmin","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","ClientID":"ae0756501dfc5de89d35","ClientSecret":"26befb359f7a466031bb96b4b7e0715c41c63fb8","owner":"liupzmin","adminUser":"['liupzmin']","labels":"['Gitalk']","perPage":15,"pagerDirection":"last","createIssueManually":true,"distractionFreeMode":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"339e142bd96f6ae8d894371917bf9c3b"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
